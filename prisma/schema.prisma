generator client {
  provider     = "prisma-client"
  output       = "../src/generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  Admin
  Recruiter
  Jobseeker
}

enum JobStatus {
  Applied
  Rejected
  Hired
  Cancelled
}

model User {
  id        Int       @id @default(autoincrement())
  email     String    @unique
  password  String
  fullname  String
  username  String    @unique
  role      Role      @default(Jobseeker)
  age       Int
  isActive  Boolean   @default(false)
  deletedAt DateTime?

  // One-to-many: recruiter -> jobs
  postedJobs Job[] @relation("RecruiterJobs")

  // One-to-many: user -> applications
  applications Application[] @relation("UserApplications")

  notifications Notification[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Job {
  id          Int    @id @default(autoincrement())
  title       String
  description String
  location    String
  salaryRange String

  // Recruiter relation
  userId Int
  user   User @relation("RecruiterJobs", fields: [userId], references: [id], onDelete: Cascade)

  // Applicants relation
  applications Application[] @relation("JobApplications")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Application {
  id Int @id @default(autoincrement())

  userId Int
  user   User @relation("UserApplications", fields: [userId], references: [id], onDelete: Cascade)

  jobId Int
  job   Job @relation("JobApplications", fields: [jobId], references: [id], onDelete: Cascade)

  status     JobStatus @default(Applied)
  resumePath String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, jobId])
}

model Notification {
  id Int @id @default(autoincrement())

  message   String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  userId Int
  user   User @relation(fields: [userId], references: [id])
}
